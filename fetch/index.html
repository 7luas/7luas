<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Filter </title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f9;
    }
    header {
      background-color: #333;
      color: #fff;
      padding: 10px;
      text-align: center;
    }
    .filters {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-wrap: nowrap;
      overflow-x: auto;
      margin: 20px 0;
      gap: 10px;
      padding: 10px;
    }
    .filter-btn {
      background-color: #eee;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      white-space: nowrap;
    }
    .filter-btn.active {
      background-color: #007BFF;
      color: #fff;
    }
    /* New style for the Featured button when active */
    #showFeaturedBtn.active {
      background-color: #ff9800;
      color: #fff;
      font-weight: bold;
    }
    /* Ensure the tag buttons inside #tags are inline */
    #tags {
      display: flex;
      gap: 10px;
    }
    .project-count {
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
      padding-bottom: 10px;
    }
    #project-list {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      padding: 0 20px;
    }
    .project-item {
      background-color: #fff;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .project-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .project-description {
      margin: 10px 0;
    }
    .project-tags {
      font-style: italic;
      color: #555;
    }
    @media (max-width: 768px) {
      #project-list {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Project Listing <span style="font-size: 0.8em; color: #bbb;">(Version 1.4)</span></h1>
  </header>

  <div class="filters">
    <button id="showAllBtn" class="filter-btn active">Show All</button>
    <button id="showFeaturedBtn" class="filter-btn">Featured</button>
    <div id="tags"></div>
  </div>

  <div class="project-count" id="projectCount">0 projects match your selection</div>

  <div id="project-list"></div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      fetch('data.json')
        .then(response => response.json())
        .then(data => {
          const projects = data.projects;
          let selectedTags = [];
          let showFeaturedOnly = false;

          const projectList = document.getElementById('project-list');
          const showAllBtn = document.getElementById('showAllBtn');
          const showFeaturedBtn = document.getElementById('showFeaturedBtn');
          const tagsContainer = document.getElementById('tags');
          const projectCount = document.getElementById('projectCount');

          // Extract all unique tags from the data
          const tags = [...new Set(projects.flatMap(project => project.tags))];

          // Dynamically generate the filter buttons based on the tags in the JSON
          tags.forEach(tag => {
            const button = document.createElement('div');
            button.classList.add('filter-btn');
            button.dataset.tag = tag;
            button.textContent = tag;
            tagsContainer.appendChild(button);

            // Add event listener to toggle tag selection; pass the button element
            button.addEventListener('click', function () {
              toggleTag(tag, this);
              updateShowAllButton();
            });
          });

          function displayProjects() {
            let filteredProjects = projects;

            if (showFeaturedOnly) {
              filteredProjects = filteredProjects.filter(project => project.featured);
            } else if (selectedTags.length > 0) {
              filteredProjects = filteredProjects.filter(project =>
                selectedTags.some(tag => project.tags.includes(tag))
              );
            }

            // Place featured projects at the beginning
            const featuredProjects = filteredProjects.filter(project => project.featured);
            const nonFeaturedProjects = filteredProjects.filter(project => !project.featured);
            filteredProjects = [...featuredProjects, ...nonFeaturedProjects];

            projectList.innerHTML = filteredProjects.map(project => `
              <div class="project-item" ${project.featured ? 'style="background-color: #ffe0b2;"' : ''}>
                <h2 class="project-title">${project.name} <span>(${project.additionalImages.length} images)</span></h2>
                <p class="project-description">${project.description}</p>
                <p class="project-tags">${project.tags.join(', ')}</p>
              </div>
            `).join('');

            projectCount.textContent = `${filteredProjects.length} project${filteredProjects.length !== 1 ? 's' : ''} match your selection`;
          }

          function toggleTag(tag, btn) {
            if (selectedTags.includes(tag)) {
              selectedTags = selectedTags.filter(t => t !== tag);
              btn.classList.remove("active");
            } else {
              selectedTags.push(tag);
              btn.classList.add("active");
            }
            // If all tags are selected, reset the selection to show all
            if (selectedTags.length === tags.length) {
              selectedTags = [];
              tagsContainer.querySelectorAll('.filter-btn').forEach(button => button.classList.remove('active'));
              showAllBtn.classList.add('active');
            } else {
              showAllBtn.classList.remove('active');
            }
            // Deactivate the Featured button if any tag is selected
            showFeaturedOnly = false;
            showFeaturedBtn.classList.remove('active');
            displayProjects();
          }

          showAllBtn.addEventListener('click', function () {
            selectedTags = [];
            showFeaturedOnly = false;
            tagsContainer.querySelectorAll('.filter-btn').forEach(button => button.classList.remove('active'));
            showAllBtn.classList.add('active');
            showFeaturedBtn.classList.remove('active'); // Revert Featured button to inactive
            displayProjects();
            updateShowAllButton();
          });

          showFeaturedBtn.addEventListener('click', function () {
            showFeaturedOnly = !showFeaturedOnly;
            // Toggle active appearance for Featured button based on state
            this.classList.toggle('active', showFeaturedOnly);
            selectedTags = [];
            tagsContainer.querySelectorAll('.filter-btn').forEach(button => button.classList.remove('active'));
            showAllBtn.classList.toggle('active', !showFeaturedOnly);
            displayProjects();
          });

          function updateShowAllButton() {
            showAllBtn.classList.toggle('active', selectedTags.length === 0 && !showFeaturedOnly);
          }

          displayProjects();
        });
    });
  </script>
</body>
</html>